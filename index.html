<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, user-scalable=no,
		shrink-to-fit=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

	<title>Basic Template App</title>

	<style>
		@import 'ui/css/evothings-app.css';
	</style>
	<script src="./libs/jquery/jquery.js" type="text/javascript"> </script>
	<script>
	//if (window.hyper && window.hyper.log) { console.log = hyper.log }
	</script>

</head>

<body ontouchstart=""><!-- ontouchstart="" enables low-delay CSS transitions. -->

	<header>
		<button class="back" onclick="history.back()">
			<img src="ui/images/arrow-left.svg" />
		</button>

		<img class="logotype" src="ui/images/logo.svg" alt="Evothings" />

		<!--<button class="menu" onclick=""><img src="ui/images/menu.svg" /></button>-->
	</header>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

	<script>



// Create an empty sensor object as a global
var office = {};
var recreational = {}
recreational.data = "";
office.data = "";
var recreationalSensorKey = 'dPjyGN0bx0IDgO000D4lI6leJGK';
var officeSensorKey = 'GqXO9z3ae9tODKPPPO2YHxw39By'

// A subscriber's key (other keys are available at http://80.69.174.27:8080/streams/)
var sensorURL = 'http://80.69.174.27:8080/output/';

// A bitmap image describing where the sensor is located
//sensor.image = "https://evothings.com/demos/dome_pics/IMG_1758.JPG";

var headers = ['barometric pressure (Pa)', 'temperature (Â°C)', 'lumination (lux)', 'carbon dioxide (ppm)']
var varNames = ['p', 't', 'l', 'c'];

function drawChart(recreationalData, officeData) {
			 console.log("DRAWCHART")
			 var variable = varNames[0];

			 var lines = [];

			 lines.push(['date', 'value'])
			recreationalData.forEach(function(row) {
				console.log(row);
				lines.push([new Date(Date.parse(row.timestamp)), parseFloat(row.p)])
				console.log("row added");
			})
			console.log(lines);
			var data = google.visualization.arrayToDataTable(lines);



//			officeData.forEach(function(row) {
	//			data.addRow([new Date(Date.parse(row.timestamp)), null, parseFloat(row.variable)])
		//		console.log("row added");
		//	})

			 var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

			 var options = {
				 interpolateNulls: true,
				 width: 900,
        height: 500
			 };

			 chart.draw(data, options);
		 }

// Function to retrieve data, placing it in a "response" object
function getJSON(key, area)
    {
    if (window.cordova)
        {
            console.log('Using Apache Cordova HTTP GET function');
            cordovaHTTP.get(
                sensorURL + key + '.json?gt[timestamp]=now-1day&page=1',
                function (response)
                    {
                        if (response)
                            {
                                area.data = response;
                            }
                    },
                function (error)
                    {
                    console.log(JSON.stringify(error));
                    });
        }
    else
        {
            console.log('Not using Cordova, fallback to AJAX via jquery');
            $.ajax({
                    url: sensorURL + key + ".json?gt[timestamp]=now-1day",
                    jsonp: "callback",
                    cache: true,
                    dataType: "jsonp",
                    data:
                        {
                            page: 1
                        },
                    success: function(response)
                        {
                            if (response && response[0])
                                {

																	    area.data = response;

                                }
                        }
                });
        }
}

getJSON(recreationalSensorKey, recreational);
getJSON(officeSensorKey, office);

google.charts.load('current', {'packages':['annotationchart']});
google.charts.setOnLoadCallback(function () {
	console.log("on callback")
	console.log(recreational.data);
  drawChart(recreational.data, office.data);
});
</script>


<script type='text/javascript'>

	</script>


<button onClick="getJSON();">Click to recieve sensor data</button>

<div id='chart_div' style='width: 900px; height: 500px;'></div>

	<script src="cordova.js"></script>
	<script src="libs/evothings/evothings.js"></script>
	<script src="libs/evothings/ui/ui.js"></script>
	<!-- TODO: Add libraries that you need -->

</body>

</html>
